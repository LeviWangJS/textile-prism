# 升级计划

## 支持全尺寸训练

### 1. 特征提取器升级
- 将 ResNet18 替换为 ConvNeXt
- 选择原因：
  - 完全卷积的架构，支持任意输入尺寸
  - 使用全局平均池化而不是固定尺寸池化
  - 特征提取能力更强
  - 对纹理细节的捕捉能力更好

### 2. 空间变换器模块改造
- 移除固定尺寸的池化层 (AdaptiveAvgPool2d(4, 4))
- 重新设计定位网络，使用全局特征提取
- 动态适应不同输入尺寸
- 考虑使用注意力机制代替固定池化

### 3. 架构其他部分
- 自注意力模块：已支持任意尺寸，无需修改
- 特征金字塔：已支持任意尺寸，无需修改
- 注意力门：使用1x1卷积，已支持任意尺寸，无需修改

### 4. 内存和性能考虑
- ConvNeXt 版本选择：
  - Tiny: 28M 参数
  - Small: 50M 参数
  - Base: 89M 参数
  - Large: 198M 参数
  - XLarge: 350M 参数
- 建议使用 ConvNeXt-Small 或 Base，平衡性能和资源消耗

### 5. 训练策略调整
- 实现动态批次大小
- 根据图像尺寸动态调整学习率
- 添加渐进式训练选项：从小尺寸开始，逐步���加

### 6. 数据加载和预处理
- 移除强制缩放
- 保持原始图像比例
- 实现动态填充以处理不同尺寸

### 7. 验证和测试
- 添加多尺度测试
- 验证不同尺寸输入的性能
- 测试内存使用和推理速度

### 8. 后续优化方向
- 实现渐进式增长训练
- 添加自适应计算时间机制
- 优化内存使用效率
